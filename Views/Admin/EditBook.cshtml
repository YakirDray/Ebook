@model BookEditViewModel

<div class="container mx-auto px-4 py-8">
    <div class="max-w-3xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">עריכת ספר</h1>

        <form asp-action="EditBook" asp-controller="Admin" method="post" enctype="multipart/form-data"
            class="bg-white rounded-lg shadow p-6">
            <input type="hidden" asp-for="Id" />
            <input type="hidden" asp-for="CurrentCoverImageUrl" />

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- מידע בסיסי -->
                <div>
                    <h2 class="text-lg font-medium mb-4">מידע בסיסי</h2>

                    <div class="mb-4">
                        <label asp-for="Title" class="block text-sm font-medium text-gray-700 mb-1">כותרת</label>
                        <input asp-for="Title" class="form-input w-full rounded-lg border-gray-300" />
                        <span asp-validation-for="Title" class="text-red-500 text-sm"></span>
                    </div>

                    <div class="mb-4">
                        <label asp-for="Author" class="block text-sm font-medium text-gray-700 mb-1">מחבר</label>
                        <input asp-for="Author" class="form-input w-full rounded-lg border-gray-300" />
                        <span asp-validation-for="Author" class="text-red-500 text-sm"></span>
                    </div>

                    <div class="mb-4">
                        <label asp-for="Publisher" class="block text-sm font-medium text-gray-700 mb-1">הוצאה
                            לאור</label>
                        <input asp-for="Publisher" class="form-input w-full rounded-lg border-gray-300" />
                        <span asp-validation-for="Publisher" class="text-red-500 text-sm"></span>
                    </div>

                    <div class="mb-4">
                        <label asp-for="YearOfPublication" class="block text-sm font-medium text-gray-700 mb-1">שנת
                            הוצאה</label>
                        <input asp-for="YearOfPublication" type="number"
                            class="form-input w-full rounded-lg border-gray-300" />
                        <span asp-validation-for="YearOfPublication" class="text-red-500 text-sm"></span>
                    </div>
                </div>

                <!-- פרטים נוספים -->
                <div>
                    <h2 class="text-lg font-medium mb-4">פרטים נוספים</h2>

                    <div class="mb-4">
                        <label asp-for="Genre" class="block text-sm font-medium text-gray-700 mb-1">ז'אנר</label>
                        <select asp-for="Genre" class="form-select w-full rounded-lg border-gray-300">
                            <option value="">בחר ז'אנר</option>
                            <option value="ספרות יפה">ספרות יפה</option>
                            <option value="ספרות עיון">ספרות עיון</option>
                            <option value="ספרי ילדים">ספרי ילדים</option>
                            <option value="ספרי לימוד">ספרי לימוד</option>
                            <option value="מדע בדיוני">מדע בדיוני</option>
                            <option value="מתח">מתח</option>
                            <option value="רומן">רומן</option>
                            <option value="ביוגרפיה">ביוגרפיה</option>
                        </select>
                        <span asp-validation-for="Genre" class="text-red-500 text-sm"></span>
                    </div>

                    <div class="mb-4">
                        <label asp-for="Description" class="block text-sm font-medium text-gray-700 mb-1">תיאור</label>
                        <textarea asp-for="Description" rows="4"
                            class="form-textarea w-full rounded-lg border-gray-300"></textarea>
                        <span asp-validation-for="Description" class="text-red-500 text-sm"></span>
                    </div>

                    <div class="mb-4">
                        <label asp-for="AgeRestriction" class="block text-sm font-medium text-gray-700 mb-1">הגבלת
                            גיל</label>
                        <select asp-for="AgeRestriction" class="form-select w-full rounded-lg border-gray-300">
                            <option value="0">ללא הגבלה</option>
                            <option value="8">+8</option>
                            <option value="12">+12</option>
                            <option value="16">+16</option>
                            <option value="18">+18</option>
                        </select>
                        <span asp-validation-for="AgeRestriction" class="text-red-500 text-sm"></span>
                    </div>
                </div>

                <!-- מחירים ומלאי -->
                <div>
                    <h2 class="text-lg font-medium mb-4">מחירים ומלאי</h2>

                    <div class="mb-4">
                        <label asp-for="BuyPrice" class="block text-sm font-medium text-gray-700 mb-1">מחיר
                            רכישה</label>
                        <input asp-for="BuyPrice" type="number" step="0.01"
                            class="form-input w-full rounded-lg border-gray-300" />
                        <span asp-validation-for="BuyPrice" class="text-red-500 text-sm"></span>
                    </div>

                    <div class="mb-4">
                        <label asp-for="BorrowPrice" class="block text-sm font-medium text-gray-700 mb-1">מחיר
                            השאלה</label>
                        <input asp-for="BorrowPrice" type="number" step="0.01"
                            class="form-input w-full rounded-lg border-gray-300" />
                        <span asp-validation-for="BorrowPrice" class="text-red-500 text-sm"></span>
                    </div>

                    <div class="mb-4">
                        <label asp-for="AvailableCopies" class="block text-sm font-medium text-gray-700 mb-1">מספר
                            עותקים</label>
                        <input asp-for="AvailableCopies" type="number"
                            class="form-input w-full rounded-lg border-gray-300" />
                        <span asp-validation-for="AvailableCopies" class="text-red-500 text-sm"></span>
                    </div>

                    <div class="mb-4">
                        <label class="flex items-center">
                            <input asp-for="IsBorrowable" type="checkbox"
                                class="form-checkbox h-4 w-4 text-blue-600 border-gray-300 rounded">
                            <span class="mr-2">ניתן להשאלה</span>
                        </label>
                    </div>

                    @if (Model.OriginalPrice.HasValue)
                    {
                        <div class="mb-4 p-4 bg-yellow-50 rounded-lg">
                            <h3 class="text-sm font-medium text-yellow-800 mb-2">הנחה פעילה</h3>
                            <p class="text-sm text-yellow-700">מחיר מקורי: ₪@Model.OriginalPrice</p>
                            @if (Model.DiscountEndDate.HasValue)
                            {
                                <p class="text-sm text-yellow-700">תאריך סיום:
                                    @Model.DiscountEndDate.Value.ToString("dd/MM/yyyy")</p>
                            }
                        </div>
                    }
                </div>

                <!-- פורמטים ותמונה -->
                <div>
                    <h2 class="text-lg font-medium mb-4">פורמטים ותמונה</h2>

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">פורמטים זמינים</label>
                        <div class="space-y-2">
                            @foreach (BookFormat format in Enum.GetValues(typeof(BookFormat)))
                            {
                                <div class="flex items-center">
                                    <input type="checkbox" name="AvailableFormats" value="@format"
                                        class="form-checkbox h-4 w-4 text-blue-600 border-gray-300 rounded"
                                    @(Model.AvailableFormats.Contains(format) ? "checked" : "")>
                                    <label class="mr-2">@format</label>
                                </div>
                            }
                        </div>
                        <span asp-validation-for="AvailableFormats" class="text-red-500 text-sm"></span>
                    </div>

                    <div class="mb-4">
                        <label asp-for="CoverImage" class="block text-sm font-medium text-gray-700 mb-1">תמונת
                            כריכה</label>
                        @if (!string.IsNullOrEmpty(Model.CurrentCoverImageUrl))
                        {
                            <div class="mb-2">
                                <img src="@Model.CurrentCoverImageUrl" alt="תמונה נוכחית"
                                    class="h-32 w-24 object-cover rounded-lg" />
                                <p class="text-sm text-gray-500 mt-1">תמונה נוכחית</p>
                            </div>
                        }
                        <input asp-for="CoverImage" type="file" accept="image/*"
                            class="form-input w-full rounded-lg border-gray-300" />
                        <span asp-validation-for="CoverImage" class="text-red-500 text-sm"></span>
                        @if (!string.IsNullOrEmpty(Model.CurrentCoverImageUrl))
                        {
                            <p class="text-sm text-gray-500 mt-1">השאר ריק אם אינך רוצה לשנות את התמונה הנוכחית</p>
                        }
                    </div>
                </div>
            </div>

            <div class="flex justify-end mt-6">
                <a href="@Url.Action("ManageBooks", "Admin")"
                    class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg ml-2">ביטול</a>
                <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-lg">שמור שינויים</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        $(document).ready(function () {
            // וידוא שנבחר לפחות פורמט אחד
            $('form').on('submit', function (e) {
                var formatChecked = $('input[name="AvailableFormats"]:checked').length;
                if (formatChecked === 0) {
                    alert('יש לבחור לפחות פורמט אחד');
                    e.preventDefault();
                    return false;
                }
                return true;
            });

            // תצוגה מקדימה של תמונה
            $('#CoverImage').on('change', function (e) {
                if (e.target.files && e.target.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        var img = $('.h-32.w-24');
                        if (img.length) {
                            img.attr('src', e.target.result);
                        } else {
                            var newImg = $('<div class="mb-2"><img src="' + e.target.result + '" class="h-32 w-24 object-cover rounded-lg" /><p class="text-sm text-gray-500 mt-1">תצוגה מקדימה</p></div>');
                            $('#CoverImage').before(newImg);
                        }
                    }
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
        });
    </script>
}